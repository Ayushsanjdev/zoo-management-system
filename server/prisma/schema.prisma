generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(uuid())
  name             String
  email            String            @unique
  password         String
  role             Role              @default(USER)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  enclosureStaff   EnclosureStaff[]
  feedingRecords   FeedingRecord[]
  healthRecords    HealthRecord[]    @relation("VetHealthRecords")
  feedingSchedules FeedingSchedule[]

  @@index([role])
  @@index([createdAt])
}

model Animal {
  id               String            @id @default(uuid())
  name             String
  species          String
  scientificName   String?
  age              Int?
  gender           String?
  healthStatus     String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  enclosureId      String?
  enclosure        Enclosure?        @relation(fields: [enclosureId], references: [id])
  feedingRecords   FeedingRecord[]
  healthRecords    HealthRecord[]
  feedingSchedules FeedingSchedule[]

  @@index([species])
  @@index([healthStatus])
  @@index([gender])
  @@index([enclosureId])
  @@index([age])
  @@index([createdAt])
  @@index([name])
  @@index([scientificName])
  @@index([species, healthStatus])
  @@index([enclosureId, species])
}

model Enclosure {
  id             String           @id @default(uuid())
  name           String
  type           String
  capacity       Int
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  animals        Animal[]
  enclosureStaff EnclosureStaff[]

  @@index([type])
  @@index([capacity])
  @@index([createdAt])
  @@index([name])
}

model EnclosureStaff {
  id          String    @id @default(uuid())
  assignedAt  DateTime  @default(now())
  staffId     String
  enclosureId String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  enclosure   Enclosure @relation(fields: [enclosureId], references: [id])
  staff       User      @relation(fields: [staffId], references: [id])

  @@index([staffId])
  @@index([enclosureId])
  @@index([assignedAt])
  @@index([createdAt])
  @@index([staffId, enclosureId])
  @@index([enclosureId, assignedAt])
}

model FeedingRecord {
  id          String           @id @default(uuid())
  foodType    String
  quantity    String?
  feedingTime DateTime         @default(now())
  notes       String?
  staffId     String
  animalId    String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  animal      Animal           @relation(fields: [animalId], references: [id])
  staff       User             @relation(fields: [staffId], references: [id])
  schedule    FeedingSchedule? @relation(fields: [scheduleId], references: [id])
  scheduleId  String?

  @@index([staffId])
  @@index([animalId])
  @@index([foodType])
  @@index([feedingTime])
  @@index([createdAt])
  @@index([animalId, feedingTime])
  @@index([staffId, feedingTime])
  @@index([animalId, foodType])
}

model FeedingSchedule {
  id          String    @id @default(uuid())
  name        String?
  foodType    String
  quantity    String
  feedingTime DateTime
  frequency   Frequency
  daysOfWeek  String?
  isActive    Boolean   @default(true)
  startDate   DateTime  @default(now())
  endDate     DateTime?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  animal   Animal @relation(fields: [animalId], references: [id])
  animalId String

  assignedStaff   User?   @relation(fields: [assignedStaffId], references: [id])
  assignedStaffId String?

  feedingRecords FeedingRecord[]

  @@index([animalId])
  @@index([feedingTime])
  @@index([frequency])
}

model HealthRecord {
  id          String   @id @default(uuid())
  checkupDate DateTime
  notes       String
  medication  String?
  animalId    String
  vetId       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  animal      Animal   @relation(fields: [animalId], references: [id])
  vet         User     @relation("VetHealthRecords", fields: [vetId], references: [id])

  @@index([animalId])
  @@index([vetId])
  @@index([checkupDate])
  @@index([createdAt])
  @@index([animalId, checkupDate])
  @@index([vetId, checkupDate])
  @@index([animalId, vetId])
}

enum Role {
  ADMIN
  STAFF
  VET
  USER
}

enum Frequency {
  ONCE_DAILY
  TWICE_DAILY
  THREE_TIMES_DAILY
  WEEKLY
  TWICE_WEEKLY
  CUSTOM
}
